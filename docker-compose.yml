# /wordpress-docker/docker-compose.yml
---
version: '3.3'
services:
    wp_install:
        container_name: 'local-wp-install'
        entrypoint: /bin/bash -c "/bin/bash -c \"$${@}\""
        depends_on: 
            - wordpress
            - db
        build: 
            context: ./
        command: sh -c "/wait && . /app/run-env-setup.sh && tail -f /dev/null"
        environment: 
            WORDPRESS_HOST: 'wordpress:80'
            WORDPRESS_DB_HOST: 'db'
            WORDPRESS_DB_USER: wordpress_user
            WORDPRESS_DB_PASSWORD: wordpress_password
            WORDPRESS_DB_NAME: wordpress_db
            WORDPRESS_REAL_HOST: 'localhost:9010'
            WAIT_HOSTS: wordpress:80, db:3306
            WAIT_HOSTS_TIMEOUT: 300
            WAIT_SLEEP_INTERVAL: 15
            WAIT_HOST_CONNECT_TIMEOUT: 15
            WP_ADMIN_USER_NAME: myuser
            WP_ADMIN_PASSWORD: password
            WP_ADMIN_EMAIL: amirali.jiwani89@gmail.com
        tty: true
        volumes:
            - .:/app
            - /app/node_modules
    db:
        container_name: 'local-wordpress-db'
        image: 'mysql:5.7'
        volumes:
          - './data/mysql:/var/lib/mysql'
        ports:
          - 18766:3306
        environment:
          MYSQL_ROOT_PASSWORD: somewordpress
          MYSQL_DATABASE: wordpress_db
          MYSQL_USER: wordpress_user
          MYSQL_PASSWORD: wordpress_password
    wordpress:
        container_name: 'local-wordpress'
        depends_on:
            - db
        image: wordpress:latest
        ports:
            - 9010:80
        environment:
            WORDPRESS_DB_HOST: 'db:3306'
            WORDPRESS_DB_USER: wordpress_user
            WORDPRESS_DB_PASSWORD: wordpress_password
            WORDPRESS_DB_NAME: wordpress_db
        volumes:
            - "./wordpress:/var/www/html"
            - "./plugins:/var/www/html/wp-content/plugins"
volumes:
    node_modules: